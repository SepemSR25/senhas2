<!DOCTYPE html>
<html lang=\"pt-BR\">
<head>
    <meta charset=\"UTF-8\">
    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">
    <title>Sistema de Senhas</title>
    <link rel=\"stylesheet\" href=\"styles.css\">
    <script src=\"api.js\"></script>
</head>
<body>
    <div class=\"container\">
        <header>
            <img src=\"logosepem.png\" alt=\"Logo SEPEM\">
            <h1>Sistema de Senhas</h1>
        </header>
        <nav>
            <a href=\"index.html\">In√≠cio</a>
            <a href=\"gerar-senha.html\">Gerar Senha</a>
            <a href=\"profissional.html\">√Årea do Profissional</a>
            <a href=\"tv.html\">Exibi√ß√£o TV</a>
        </nav>

        <h2 class=\"section-title\">Selecionar Sala</h2>
        <div class=\"grid-container\" id=\"salas-grid\">
            <!-- Salas ser√£o carregadas aqui pelo JavaScript -->
        </div>

        <h2 class=\"section-title\">A√ß√µes Principais</h2>
        <div class=\"grid-container\">
            <a href=\"gerar-senha.html\" class=\"card\">
                <span role=\"img\" aria-label=\"ticket\">üé´</span>
                <h3>Gerar Senha</h3>
                <p>Retire sua senha e aguarde ser chamado</p>
            </a>
            <a href=\"profissional.html\" class=\"card\">
                <span role=\"img\" aria-label=\"man\">üë®‚Äçüíº</span>
                <h3>√Årea do Profissional</h3>
                <p>Chame a pr√≥xima senha da fila</p>
            </a>
            <a href=\"tv.html\" class=\"card\">
                <span role=\"img\" aria-label=\"tv\">üì∫</span>
                <h3>Exibi√ß√£o TV</h3>
                <p>Painel para exibi√ß√£o na televis√£o</p>
            </a>
            <div class=\"card\">
                <span role=\"img\" aria-label=\"reset\">üîÑ</span>
                <h3>Resetar Atendimento</h3>
                <p>Limpar display da TV</p>
                <button class=\"button button-danger\" onclick=\"confirmReset()\">Resetar Atendimento</button>
            </div>
        </div>

        <div class=\"footer\">
            <p>‚ö° DESENVOLVIDO POR SAULO RODRIGO REG. 36.364-8 - 2025</p>
        </div>
    </div>

    <script>
        document.addEventListener(\"DOMContentLoaded\", async () => {
            const salasGrid = document.getElementById(\"salas-grid\");
            const salas = await fetchSalas();

            salas.forEach(sala => {
                const salaCard = document.createElement(\"div\");
                salaCard.className = \"card\";
                salaCard.innerHTML = `
                    <span role=\"img\" aria-label=\"building\">üè¢</span>
                    <h3>${sala.nome}</h3>
                    <p>${sala.descricao}</p>
                    <button class=\"button\" onclick=\"window.location.href=\\\'profissional.html?room_id=${sala.id}\\\'\">Selecionar</button>
                    <button class=\"button button-danger\" onclick=\"deleteSala(${sala.id})\">üóëÔ∏è</button>
                `;
                salasGrid.appendChild(salaCard);
            });
        });

        async function confirmReset() {
            if (confirm(\"Tem certeza que deseja resetar o atendimento? Isso mover√° todas as senhas \\\'chamadas\\\' para \\\'atendidas\\\' e resetar√° os contadores de senhas.\")) {
                const result = await resetarAtendimento();
                if (result && result.message) {
                    alert(result.message);
                    // Opcional: recarregar a p√°gina ou atualizar o display da TV
                } else {
                    alert(\"Erro ao resetar atendimento.\");
                }
            }
        }

        async function deleteSala(id) {
            if (confirm(\"Tem certeza que deseja deletar esta sala? Esta a√ß√£o √© irrevers√≠vel.\")) {
                try {
                    const response = await fetch(`${API_BASE_URL}/api/salas/${id}`, {
                        method: \"DELETE\"
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const result = await response.json();
                    alert(result.message);
                    location.reload(); // Recarrega a p√°gina para atualizar a lista de salas
                } catch (error) {
                    console.error(\"Erro ao deletar sala:\", error);
                    alert(\"Erro ao deletar sala.\");
                }
            }
        }
    </script>
</body>
</html>


